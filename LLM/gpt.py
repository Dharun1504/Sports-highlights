import os
import openai
from dotenv import load_dotenv
import dotenv
load_dotenv()

class LLM:
    
    def get_timestamps(self, commentary):
        openai.api_type = "azure"
        openai.api_base = "https://openai-demetrius.openai.azure.com/"
        openai.api_version = "2023-07-01-preview"
        openai.api_key = dotenv.get_key(key_to_get="OPENAI_API_KEY", dotenv_path = "F:\Software-Project\Sport-Highlights\LLM\.env")      
 
        message_text = [{"role":"system","content":f"You are an AI assistant that finds important events in a cricket match when you are provided with the commentary transcripts with timestamps. Return the timestamps of the important events alone in a json format.  :  {commentary}"}]

        self.completion = openai.ChatCompletion.create(
        engine="gpt4-demetrius",
        messages = message_text,
        temperature=0.7,
        max_tokens=800,
        top_p=0.95,
        frequency_penalty=0,
        presence_penalty=0,
        stop=None
        )
    
    
        return self.completion
        


# commentary = "[{'timestamp': (0.0, 7.0), 'text': ' a beautiful look Yorker is'}, {'timestamp': (7.0, 9.0), 'text': \" gone\nthrough the Indian captain. Well he hadn't had a\"}, {'timestamp': (9.0, 12.0), 'text': ' batsman board\nfor some time but'}, {'timestamp': (12.0, 13.0), 'text': \" he's picked the right moment to\"},\n{'timestamp': (13.0, 15.0), 'text': ' dismiss Mahendras Singh Doni and'}, {'timestamp': (15.0, 17.0),\n'text': ' what a critical victory turned out'}, {'timestamp': (17.0, 19.0), 'text': ' to be Doni gone for the'},\n{'timestamp': (19.0, 22.0), 'text': ' D. Run. What a wicked that could'}, {'timestamp': (22.0, 23.0),\n'text': ' make a huge difference to this'}, {'timestamp': (23.0, 27.0), 'text': ' match.'}, {'timestamp':\n(30.0, 34.0), 'text': \" That's how we WS is going to be ever play bow.\"}, {'timestamp': (34.0, 38.0),\n'text': ' Goodbye Rohit Sharma, first ball.'}, {'timestamp': (38.0, 41.0), 'text': ' Good last hit, my link\nhas struck again.'}, {'timestamp': (41.0, 44.0), 'text': ' Take a look at that.'}, {'timestamp': (44.0,\n46.0), 'text': ' Very, very close indeed.'}, {'timestamp': (46.0, 50.0), 'text': \" It's surely hitting the stop\nall the time.\"}, {'timestamp': (50.0, 53.0), 'text': ' The 180 before India.'}, {'timestamp': (53.0, 57.0),\n'text': \" Delivery, let's see what he can do.\"}, {'timestamp': (57.0, 60.0), 'text': ' Oh, nicely played. I\nthink it probably pitched just outside leg'}, {'timestamp': (60.0, 68.0), 'text': \" stumps. You're going to\ncrash into the stumps but it was well played.\"}, {'timestamp': (70.0, 72.0), 'text': \" That's beautifully\nplayed. That's Garnum Gumbeer's 11th one day at the National 100.\"}, {'timestamp': (72.0, 76.0),\n'text': \" He's 6th against Sri Lanka and he's second on this ground.\"}, {'timestamp': (76.0, 80.0),\n'text': ' When he had to endure some difficult time when Garnum Garnum got out.'}, {'timestamp':\n(82.0, 87.0), 'text': \" And there's the acknowledgement from Gotham Gambi.\"}, {'timestamp': (87.0,\n94.0), 'text': \" Oh yes, I think he's got him.\"}, {'timestamp': (94.0, 97.0), 'text': \" I think that's out.\nThat's a direct hit.\"}, {'timestamp': (97.0, 99.0), 'text': ' I think that one may be out.'}, {'timestamp':\n(99.0, 101.0), 'text': \" It's just good feeling. He's got a shine.\"}, {'timestamp': (101.0, 104.0), 'text': \"\nThe stuff that he's got him by a long way.\"}, {'timestamp': (104.0, 105.92), 'text': \" It's not happy with\nhim, so he either.\"}, {'timestamp': (111.68, 114.08), 'text': ' Oh, good shot. That is a super shot.'},\n{'timestamp': (119.84, 121.2), 'text': \" Oh, he's dropped it.\"}, {'timestamp': (122.56, 124.08), 'text': \"\nAnd he's got good hands.\"}, {'timestamp': (126.04, 129.96), 'text': \" The race ran, I's batting part\nthere.\"}, {'timestamp': (129.96, 132.64), 'text': \" He was looking for elevation which he didn't get.\"},\n{'timestamp': (132.64, 138.12), 'text': ' Everyone would have been a good catch because the ball\nlooked...'}, {'timestamp': (138.12, 139.48), 'text': \" He's got four.\"}, {'timestamp': (139.48, 141.68),\n'text': ' And the charge this time working for Durace Rana.'}, {'timestamp': (141.68, 143.4), 'text': '\nHe charged the ball up.'}, {'timestamp': (143.4, 147.76), 'text': \" Got him to change his length and\nthe line. But they got to carry on going in that passion you're right\"}, {'timestamp': (147.76, 150.2),\n'text': ' about the fact that'}, {'timestamp': (153.6, 159.64), 'text': \" oh that's gone very fine and that's\ngood thinking from Surre Surana\"}, {'timestamp': (167.0, 174.0), 'text': \" I think there are some\n\n1/5/24, 5:59 PM ChatGPT\n\nhttps://chat.openai.com/c/483ebac1-46c7-4699-b5aa-c3a5f9e98f4a 2/3\nareas where a batsman is. It's another edge to get some streaky shots from the Indians.\"},\n{'timestamp': (174.0, 177.0), 'text': \" It's sculpted on the offside.\"}, {'timestamp': (177.0, 180.0), 'text':\n\" This is a shot we were talking about from St. Rai's round on the offside.\"}, {'timestamp': (180.0,\n183.0), 'text': ' A lofted drive and a great start to the over.'}, {'timestamp': (183.0, 184.0), 'text': ' Two\neggs.'}, {'timestamp': (184.0, 186.0), 'text': ' Perfectly done.'}, {'timestamp': (186.0, 188.0), 'text': '\nBring the 50th of the partnership.'}, {'timestamp': (188.0, 191.0), 'text': ' 53 or 40 these two have put\non.'}, {'timestamp': (191.0, 194.0), 'text': ' Under the circumstances and in the situation,'},\n{'timestamp': (194.0, 196.0), 'text': ' invaluable.'}, {'timestamp': (199.0, 202.0), 'text': \" Inside edge\nthere's been some good luck going in the\"}, {'timestamp': (202.0, 204.0), 'text': ' as way in the last\nfew overs.'}, {'timestamp': (204.0, 207.84), 'text': ' See lots of runs in that direction of inside\nedges.'}, {'timestamp': (207.84, 213.16), 'text': ' Progressive intent, kind of play inside out, kind of\nplay to covers, bring it a little'}, {'timestamp': (213.16, 216.76), 'text': ' early, getting the inside edge,\nbetterlessly close to that.'}, {'timestamp': (216.76, 221.52), 'text': \" Well that's in the air, but it's going\nto go over the top.\"}, {'timestamp': (221.52, 225.0), 'text': \" There's no one back in that area and it's\ngone.\"}, {'timestamp': (225.0, 232.0), 'text': \" Well, that's bring brings up Rhiners 50, 23rd, 1 day to\nNational 50 and the 7th against Shrelaga.\"}, {'timestamp': (233.0, 234.0), 'text': ' 6th.'}, {'timestamp':\n(235.0, 237.0), 'text': \" That's as if it was his unit.\"}, {'timestamp': (239.0, 248.0), 'text': ' The only\nquestions asked with no reaction there from Mahela when he took off Malinga.'}, {'timestamp':\n(248.0, 251.0), 'text': ' A Matthews.'}, {'timestamp': (251.0, 256.0), 'text': \" Well that went a smash\naway nice and firmly and I'll get to.\"}, {'timestamp': (256.0, 260.0), 'text': ' Well it would have gone\nall the way there to be cut up back there.'}, {'timestamp': (270.36, 272.36), 'text': \" He probably\nthought of one stage that there were riding business as to getting China's ladies on strike now in\n64.\"}, {'timestamp': (272.36, 280.04), 'text': ' And try to smash the way through the upside field and\nother single through his Rina.'}, {'timestamp': (280.04, 287.0), 'text': ' Big coming in a difficult time\nthat he was hardly in when he lost the established batsman.'}, {'timestamp': (290.0, 294.0), 'text': \"\nOh, and what's the point in that?\"}, {'timestamp': (298.0, 303.0), 'text': ' And got that leg side\nboundary protected by three men.'}, {'timestamp': (309.0, 317.0), 'text': \" Run if the ball goes to the\nkeeper. Is it that good? But in the air for four, that's it. Back never since shot. So the Indians\"},\n{'timestamp': (317.0, 326.0), 'text': ' win and they winning style actually. This is the highest\nsuccessful chase by any side on Sri Lankan soil over the game.'}, {'timestamp': (326.0, 331.0),\n'text': \" And I'm finished with in style and I'm there delighted.\"}, {'timestamp': (331.0, 338.0), 'text': '\nThe broken, unbeaten record of Sri Lanka, we Indians have managed to change it.'}]"   

# llm = LLM()
# completion = llm.get_timestamps(commentary)


# print (completion)
